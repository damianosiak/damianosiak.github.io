<!doctype html>
<html>
<head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<style>
html,
body,
#map-canvas {
  height: 90%;
  width: 100%;
  margin: 0px;
  padding: 0px
}

#routebtn{
	width: 100%;
	background-color: #66CC66;
	height:6%;
	font-weight:bold;
	font-size:18px;
}

#loadingPanel{
	display:none;
	position:absolute;
	margin: auto;
	top: 15%;
	background-color:rgba(0,0,0,.25);
	width:30%;
	left:35%;
	padding-bottom:30px;
	border-radius: 50px;
	border:none;
}

#progressDescription{
	font-size:34px;
	color:white;
	font-weight:bold;
	background-color:rgba(0,0,0,.25);
	text-align:center;
	padding-top:15px;
	padding-bottom:15px;
	width:50%;
	margin: 0 auto;
	margin-top:30px;
}

#progressBarDiv{
	margin: 0 auto;
	padding-top:30px;
	text-align: center;
}

#progressBar{
	width:75%;
	height:100px;
	margin: 0 auto;
	position:relative;
}

#progressBar:before {
  content: attr(data-label);
  font-size: 24px;
  vertical-align: 0
  position:absolute;
  left:0;
  right:0;
}

#loader {
	margin: auto;
  border: 16px solid #f3f3f3; /* Light grey */
  border-top: 16px solid #3498db; /* Blue */
  border-radius: 50%;
  width: 150px;
  height: 150px;
  animation: spin 2s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}


#progressTitle{
	text-align:center;
	margin: 30px auto;
	background-color:rgba(0,0,0,.2);
	font-size:28px;
	width:99%;
	font-weight:bold;
}

#progressTitle:after{
  overflow: hidden;
  display: inline-block;
  vertical-align: bottom;
  -webkit-animation: ellipsis steps(4,end) 1500ms infinite;      
  animation: ellipsis steps(4,end) 1500ms infinite;
  content: "\00a0"; /* ascii code for the ellipsis character */
  float:left;
  width: 0px;
}

@keyframes ellipsis {
  to {
    width: -40px;    
  }
}

@-webkit-keyframes ellipsis {
  to {
    width: -40px;    
  }
}




#progress {
  height: 1.5em;
  width: 80%;
  background-color: #c9c9c9;
  position: relative;
  margin:30px auto;
  font-size:24px;
  border-radius: 50px;
}
#progress:before {
  content: attr(data-label);
  font-size: 0.8em;
  position: absolute;
  text-align: center;
  top: 5px;
  left: 0;
  right: 0;
  
}
#progress #progressValue {
  background-color: #7cc4ff;
  display: inline-block;
  height: 100%;
  border-radius: 50px 0px 0px 50px;
}

#map-canvas{
  pointer-events: auto;  
}


#progressTitleDots:after{
  overflow: hidden;
  display: inline-block;
  vertical-align: bottom;
  -webkit-animation: ellipsis steps(4,end) 1500ms infinite;      
  animation: ellipsis steps(4,end) 1500ms infinite;
  content: "\2026"; /* ascii code for the ellipsis character */
  width: 0px;
}

@keyframes ellipsis {
  to {
    width: 40px;    
  }
}

@-webkit-keyframes ellipsis {
  to {
    width: 40px;    
  }
}








#summaryTable{
	width: 100%;
}

#rowsInTab{
	overflow-x: hidden;
    overflow-y: auto;
}



#panelWithDetails{
	overflow:none;
	background-color:rgba(0,0,0,.8);
	left:15%;
	position:absolute;
	width:70%;
	height:90%;
	top:2%;
	border-radius: 25px;
	border-style:solid;
	border-width:2px;
	border-color:white;
	display:none;
	z-index:1;
}

#panelWithDetailsTable{
	margin:auto;
	width:95%;
	background-color:rgba(255,255,255,.6);
	color:black;
	max-height:82%;
	overflow-y: scroll;
}


#detailsPanelHeader{
	color:white;
	font-size: 28px;
	font-weight:bold;
	text-align:center;
	padding-top:2%;
}

#detailsTable{
	color:black;
}

#detailsPanelCloseButton{
	position:absolute;
	width:75px;
	height:40px;
	border-radius:25px;
	top:15px;
	right:25px;
}


#actionButtonContainer{
	text-align:center;
	margin:auto;
	bottom:15px;
	padding-top:18px;
}

.actionButton{
	width:450px;
}

#controlPanel{
	position:absolute;
	top: 10px;
	right:55px;
	background-color:rgba(0,0,0,.0);
	z-index:1;
}

.controlButton{
	width:150px;
	height:40px;
	border:none;
	font-size:16px;
}

#addressFoundContainer{
	position: absolute;
	top:55px;
	right:0px;
	width: 359px;
	z-index:1;
	background-color:rgba(0,0,0,.25);
	padding-left:5px;
	font-size:14px;
	display:none;
}

#foundLocationButtonContainer{
	z-index:1;
	position:absolute;
	top:80px;
	right:0px;
	display:none;
}

.foundLocationButton{
	width: 100px;
	height:30px;
	z-index:1;
	border:none;
}


#allAddedLocationsPanel{
	overflow:none;
	background-color:rgba(0,0,0,.8);
	left:25%;
	position:absolute;
	width:50%;
	height:90%;
	top:2%;
	border-radius: 25px;
	border-style:solid;
	border-width:2px;
	border-color:white;
	display:none;
	z-index:1;
}

#allAddedLocationsPanelCloseButton{
	position:absolute;
	width:75px;
	height:40px;
	border-radius:25px;
	top:15px;
	right:25px;
}


#allAddedLocationsPanelHeader{
	color:white;
	font-size: 28px;
	font-weight:bold;
	text-align:center;
	padding-top:2%;
}


#allAddedLocationsPanelTableContainer{
	margin:auto;
	width:95%;
	background-color:rgba(255,255,255,.6);
	color:black;
	max-height:82%;
	overflow-y: scroll;
}


#allAddedLocationsPanelTable{
	color:black;
}

#allAddedLocationsButtonContainer{
	position:absolute;
	right:55px;
	top:67%;
	background-color:rgba(0,0,0,.0);
	z-index:1;
}


#allAddedLocationsButton{
	width:300px;
	height:40px;
}




#loadingPanelForListOfAllPoints{
	display:none;
	position:absolute;
	margin: auto;
	top: 15%;
	background-color:rgba(0,0,0,.25);
	width:32%;	
	left:34%;
	padding-bottom:30px;
	border-radius: 50px;
	border:none;
}

#loadingPanelForListOfAllPoints_progressTitle{
	text-align:center;
	margin: 30px auto;
	background-color:rgba(0,0,0,.2);
	font-size:28px;
	width:99%;
	font-weight:bold;
}

#loadingPanelForListOfAllPoints_progressTitle:after{
  overflow: hidden;
  display: inline-block;
  vertical-align: bottom;
  -webkit-animation: ellipsis steps(4,end) 1500ms infinite;      
  animation: ellipsis steps(4,end) 1500ms infinite;
  content: "\00a0"; /* ascii code for the ellipsis character */
  float:left;
  width: 0px;
}

#loadingPanelForListOfAllPoints_progressTitleDots:after{
	overflow: hidden;
  display: inline-block;
  vertical-align: bottom;
  -webkit-animation: ellipsis steps(4,end) 1500ms infinite;      
  animation: ellipsis steps(4,end) 1500ms infinite;
  content: "\2026"; /* ascii code for the ellipsis character */
  width: 0px;
}

#loadingPanelForListOfAllPoints_loader{
	margin: auto;
  border: 16px solid #f3f3f3; /* Light grey */
  border-top: 16px solid #3498db; /* Blue */
  border-radius: 50%;
  width: 150px;
  height: 150px;
  animation: spin 2s linear infinite;
}

#loadingPanelForListOfAllPoints_progress{
	height: 1.5em;
  width: 80%;
  background-color: #c9c9c9;
  position: relative;
  margin:30px auto;
  font-size:24px;
  border-radius: 50px;
}
#loadingPanelForListOfAllPoints_progress:before {
  content: attr(data-label);
  font-size: 0.8em;
  position: absolute;
  text-align: center;
  top: 5px;
  left: 0;
  right: 0;
  
}

#loadingPanelForListOfAllPoints_progress #loadingPanelForListOfAllPoints_progressValue{
	background-color: #7cc4ff;
  display: inline-block;
  height: 100%;
  border-radius: 50px 0px 0px 50px;
}


#estimatedTime{
	text-align:center;
}

#loadingPanelForListOfAllPoints_estimatedTime{
	text-align:center;
}

#selectDriveMethodPanel{
	display:none;
	width: 30%;
	position: absolute;
	top: 15%;
	background-color: rgba(0,0,0,.25);
	z-index:1;
	border-radius: 25px;
	left: 35%;
	padding-top: 15px;
	padding-bottom: 30px;
	border-width:2px;
	border-color:white;
	border-style:solid;
}

#selectDriveMethodPanel_Header{
	color: white;
	font-size: 28px;
	text-align: center;
	font-weight: bold;
}

#selectDriveMethodPanel_ButtonsContainer{
	margin: auto;
	text-align: center;
	/*padding-bottom: 15px;*/
}

.selectDriveMethodPanel_Button{
	position: relative;
	width: 22%;
	border-radius: 25px;
}

</style>
</head>

<body>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCnTaFvn6gIBArdHDPhnGefaqP3xpra9xM"></script>
<div id="controlPanel">
	<button type="button" class="btn btn-info controlButton" id="searchLocationButton" onClick="geocodeButton();">Search</button>
	<button type="button" class="btn btn-info controlButton" id="resetMapButton" onClick="resetMap();">Reset</button><br/>
</div>
<p id="addressFoundContainer">Found:</p>
<div id="foundLocationButtonContainer">
	<button type="button" class="foundLocationButton btn btn-warning" id="addFoundLocationButton" onClick="addFoundLocation();">Add found</button>
	<button type="button" class="foundLocationButton btn btn-warning" id="clearSearchButton" onClick="clearMarkers();">Clear</button>
</div>
<div id="allAddedLocationsButtonContainer">
	<button type="button" id="allAddedLocationsButton" class="btn btn-info" onClick="showAllAddedLocationsList();">List of all added locations</button>
</div>

<div id="map-canvas"></div>
<div id="loadingPanel">
	<div id="progressTitle">Calculating the best route<span id="progressTitleDots"></span></div>
	<div id="loader"></div>
	<!--<p id="progressDescription">1/5</p>-->
	<!--<div id="progressBarDiv">
		<progress id="progressBar" value="0" max="100" data-label="Value"></progress>
	</div>-->
	<div id="progress" data-label="0% Complete">
		<span id="progressValue" style="width:0%;"></span>
	</div>
	<!--<div id="estimatedTime">Estimated time:&#160;&#160;&#160;</div>-->
	<div id="estimatedTime"></div>
</div>

<div id="loadingPanelForListOfAllPoints">
	<div id="loadingPanelForListOfAllPoints_progressTitle">Retriving addresses from your locations<span id="loadingPanelForListOfAllPoints_progressTitleDots"></span></div>
	<div id="loadingPanelForListOfAllPoints_loader"></div>
	<div id="loadingPanelForListOfAllPoints_progress" data-label="0% Complete">
		<span id="loadingPanelForListOfAllPoints_progressValue" style="width:0%;"></span>
	</div>
	<!--<div id="loadingPanelForListOfAllPoints_estimatedTime">Estimated time:&#160;&#160;&#160;</div>-->
	<div id="loadingPanelForListOfAllPoints_estimatedTime"></div>
</div>

<div id='selectDriveMethodPanel'>
	<p id='selectDriveMethodPanel_Header'>Select a method:</p>
	<div id='selectDriveMethodPanel_ButtonsContainer'>
		<button id='selectDriveMethodPanel_Button_Driving' class="selectDriveMethodPanel_Button btn btn-primary" onClick="setTravelMode('DRIVING');">Driving</button>
		<button id='selectDriveMethodPanel_Button_Bicycling' class="selectDriveMethodPanel_Button btn btn-primary" onClick="setTravelMode('BICYCLING');">Bicycling</button>
		<button id='selectDriveMethodPanel_Button_Transit' class="selectDriveMethodPanel_Button btn btn-primary" onClick="setTravelMode('TRANSIT');">Transit</button>
		<button id='selectDriveMethodPanel_Button_Walking' class="selectDriveMethodPanel_Button btn btn-primary" onClick="setTravelMode('WALKING');">Walking</button>
		<!--<button id="myBtn">Try it</button>-->
	</div>
</div>

<!--<input type="button" class="btn" id="routebtn" value="Calculate the best route" />-->
<input type="button" class="btn" id="routebtn" onClick="showDriveMethodPanel();" value="Calculate the best route" />


<div id="allAddedLocationsPanel">
	<button id="allAddedLocationsPanelCloseButton" type="button" class="btn btn-danger" onClick="allAddedLocationsPanelCloseButtonAction();">Close</button>
	<p id="allAddedLocationsPanelHeader">List of all added locations</p>
	<div id="allAddedLocationsPanelTableContainer">
		<table id="allAddedLocationsPanelTable" class="table table-hover table-striped table-bordered">
			<tr>
				<th>Location mark</th>
				<th>Full ocation address</th>
				<th>Delete</th>
			</tr>
		</table>
	</div>
</div>



<table id="summaryTable" class="table table-hover table-striped table-bordered">
	<tr>
		<th colspan="5" style="font-size:20px">The best route summary</th>
	</tr>
	<tr>
		<th>Start location</th>
		<th>End location</th>
		<th>Distance</th>
		<th>Duration</th>
	</tr>
	<tr>
		<td id="result_StartLocation">&#160;</td>
		<td id="result_EndLocation">&#160;</td>
		<td id="result_Distance">&#160;</td>
		<td id="result_Duration">&#160;</td>
	</tr>
	<tr>
		<td colspan="5" style="padding: 0 !important;margin: 0 !important;height:9vh;font-size:24px"><button type="button" class="btn" style="width:100%;height:100%;border:none;font-size:18px;font-weight:bold" onClick="detailsPanelOpenButtonAction();">Details (click me)</button></td>
	</tr>
</table>

<div id="panelWithDetails">
	<button id="detailsPanelCloseButton" type="button" class="btn btn-danger" onClick="detailsPanelCloseButtonAction();">Close</button>
	<p id="detailsPanelHeader">The best route details</p>
	<div id="panelWithDetailsTable">
		<table id="detailsTable" class="table table-hover table-striped table-bordered">
			<tr>
				<th rowspan="2">Summary</th>
				<th>Start location</th>
				<th>End location</th>
				<th>Distance</th>
				<th>Duration</th>
			</tr>
			<tr>
				<td id="detailedResult_StartLocation">&#160;</td>
				<td id="detailedResult_EndLocation">&#160;</td>
				<td id="detailedResult_Distance">&#160;</td>
				<td id="detailedResult_Duration">&#160;</td>
			</tr>
			
			<tr><td colspan="5">&#160;</td></tr>
			
			<tr id="tableDetailsHeader">
				<th>Route part</th>
				<th>Start location</th>
				<th>End location</th>
				<th>Distance</th>
				<th>Duration</th>
			</tr>
		</table>
	</div>
	<div id="actionButtonContainer">
		<!--<button type="button" class="actionButton btn btn-primary" onClick="saveAsPDF();">Save as a PDF</button>
		<button type="button" class="actionButton btn btn-primary" onClick="shareViaEmail();">Share via e-mail</button>
		<button type="button" class="actionButton btn btn-primary">Print</button>-->
		<button type="button" class="actionButton btn btn-primary" onClick="saveAsPDF();">Print / Save as a PDF</button>
	</div>
</div>

<script>

//var loadingActionForLoadingListWithAllPoint(){
//	
//}

//var timerForLoadingActionForLoadingListWithAllPoint(i){
//	setTimeout(function(){
//	
//	},i*250);
//}

var chicago = new google.maps.LatLng(49.944630, 18.597937);
var mapOptions = {
	zoom: 14,
	center: chicago
};
var travelMode="DRIVING";
var tempFoundLocation=[];
let labelIndex = 0;
var selectedLocationsAddressesArray=[];

function showDriveMethodPanel(){
	document.getElementById("selectDriveMethodPanel").style.display="inline";
}

function setTravelMode(method){
	document.getElementById("selectDriveMethodPanel").style.display="none";
	if(method=="DRIVING" || method=="BICYCLING" || method=="WALKING" || method=="TRANSIT"){
		travelMode=method;
	}
	calcRoute();
	
	//alert("coo");
	//document.getElementById("selectDriveMethodPanel").style.display="none";
}
//document.getElementById("selectDriveMethodPanel_Button_Driving").addEventListener("click",function(){travelMode="DRIVING";document.getElementById("selectDriveMethodPanel").style.display="none";});
//document.getElementById("selectDriveMethodPanel_Button_Bicycling").addEventListener("click",function(){travelMode="BICYCLING";document.getElementById("selectDriveMethodPanel").style.display="none";});
//document.getElementById("selectDriveMethodPanel_Button_Transit").addEventListener("click",function(){travelMode="WALKING";document.getElementById("selectDriveMethodPanel").style.display="none";});
//document.getElementById("selectDriveMethodPanel_Button_Walking").addEventListener("click",function(){travelMode="TRANSIT";document.getElementById("selectDriveMethodPanel").style.display="none";});
//document.getElementById("myBtn").addEventListener("click", setTravelMode("TRANSIT"));

function showSelectTravelMethodPanel(){
	//var panel="";
}


function fillSelectedLoactionsAddressesArray(location) {
  var request={address:location};
  geocoder
    .geocode(request)
    .then((result) => {
      var address=result.results[0].formatted_address;
      selectedLocationsAddressesArray.push(address);
    })
    .catch((e) => {
      //alert("Geocode was not successful for the following reason: " + e);
    });
}


function estimateTimeCounter(iterations,waittime,divid){
	if((iterations>0)||(waittime>0)||(divid.length>0)){
		//document.getElementById(divid).innerHTML="Estimated time: "+(iterations*waittime/1000);
		for(var i=1;i<=iterations;i++){
			estimateTimeCounterTimeout(i,iterations,waittime,divid);
		}
	}
	//
}
function estimateTimeCounterTimeout(i,iterations,waittime,divid){
	setTimeout(function(){
		//alert(i);
		//alert(iterations);
		var estimateTimeSeconds=Math.ceil(((iterations-i)*waittime)/1000);
		//alert(estimateTimeSeconds);
		var estimateTime="";
		if(estimateTimeSeconds>=60){
			if(estimateTimeSeconds>=3600){
				if(estimateTimeSeconds>=86400){
					//days
					var estimateTimeDays=Math.floor(estimateTimeSeconds/86400);
					estimateTimeSeconds=estimateTimeSeconds-(estimateTimeDay*86400);
					var estimateTimeHours=Math.floor(estimateTimeSeconds/3600);
					estimateTimeSeconds=estimateTimeSeconds-(estimateTimeHours*3600);
					var estimateTimeMinutes=Math.floor(estimateTimeSeconds/60);
					estimateTimeSeconds=estimateTimeSeconds-(estimateTimeMinutes*60);
					estimateTime=""+estimateTimeDays+"d "+estimateTimeHours+"h "+estimateTimeMinutes+"min "+estimateTimeSeconds+"sec";
				}else{
					//hours
					var estimateTimeHours=Math.floor(estimateTimeSeconds/3600);
					estimateTimeSeconds=estimateTimeSeconds-(estimateTimeHours*3600);
					var estimateTimeMinutes=Math.floor(estimateTimeSeconds/60);
					estimateTimeSeconds=estimateTimeSeconds-(estimateTimeMinutes*60);
					estimateTime=""+estimateTimeHours+"h "+estimateTimeMinutes+"min "+estimateTimeSeconds+"sec";
				}
			}else{
				//minutes
				var estimateTimeMinutes=Math.floor(estimateTimeSeconds/60);
				estimateTimeSeconds=estimateTimeSeconds-(estimateTimeMinutes*60);
				estimateTime=""+estimateTimeMinutes+"min "+estimateTimeSeconds+"sec";
			}
		}else{
			//seconds//nochange
			estimateTime=""+estimateTimeSeconds+"sec";
		}
		//console.log("Estimated time: "+estimateTime);
		document.getElementById(divid).innerHTML="Estimated time: "+estimateTime;
	},i*waittime);
}



function showAllAddedLocationsList(){
	//TUTAJ WYŚWIETLIĆ LOADING PANEL
	document.getElementById("loadingPanelForListOfAllPoints").style.display="inline";
	//selectedLocationsAddressesArray=[];
	document.getElementById("allAddedLocationsPanelTable").innerHTML="<tr><th>Location mark</th><th>Full ocation address</th><th>Delete</th></tr>";
	var k=points.length;
	if(selectedLocationsAddressesArray.length==points.length){
		document.getElementById("loadingPanelForListOfAllPoints").style.display="none";
		showAllAddedLocationsList2();
	}else{
		selectedLocationsAddressesArray=[];
		estimateTimeCounter(points.length,250,"loadingPanelForListOfAllPoints_estimatedTime");
		for(var i=1;i<=points.length;i++){
			setTimeoutForShowAllAddedLocationsList(i,k);
		}
		setTimeout(function(){
			//alert("hej");
			//TUTAJ UKRYC LOADING PANEL
			document.getElementById("loadingPanelForListOfAllPoints").style.display="none";
			document.getElementById("loadingPanelForListOfAllPoints_progressValue").style.width=0;
			document.getElementById("loadingPanelForListOfAllPoints_progress").setAttribute("data-label","0% Complete");
			showAllAddedLocationsList2();
		},(points.length*250)+250);
		//showAllAddedLocationsList2();
	}
}


function setTimeoutForShowAllAddedLocationsList(i,k){
	setTimeout(function(){
		//console.log(points[i-1]);
		//console.log(i);
		var tempLocation=""+points[i-1][0]+","+points[i-1][1];
		fillSelectedLoactionsAddressesArray(tempLocation);
		//TUTAJ DODAĆ ZMIANĘ W LOADING PANELU
		var percent=""+(((i)*100)/k)+"%";
		var percentRounded=Math.round((((i)*100)/k));
		document.getElementById("loadingPanelForListOfAllPoints_progressValue").style.width=percent;
		document.getElementById("loadingPanelForListOfAllPoints_progress").setAttribute("data-label",percentRounded+"% Complete");
		//document.getElementById("loadingPanelForListOfAllPoints_progressValue").value="";
	},i*250);
}

function deletePointFromList(i){
	//alert("Do you want to delete point "+i+"?");
	var tempArray=points;
	var tempSelectedLocationsAddressesArray=selectedLocationsAddressesArray;
	labelIndex=0;
	points=[];
	selectedLocationsAddressesArray=[];
	console.log("To jest templAddrArr:");console.log(tempSelectedLocationsAddressesArray);
	console.log("To jest AddrArr:");console.log(selectedLocationsAddressesArray);
	for(var y=0;y<tempArray.length;y++){
		if(y!=i){
			points.push(tempArray[y]);
		}
	}
	
	for(var yy=0;yy<tempSelectedLocationsAddressesArray.length;yy++){
		if(yy!=i){
			selectedLocationsAddressesArray.push(tempSelectedLocationsAddressesArray[yy]);
		}
	}
	
	//document.getElementById("allAddedLocationsPanelTable").innerHTML="<tr><th>Location mark</th><th>Full ocation address</th><th>Delete</th></tr>";
	var tempStringWithTr="<tr><th>Location mark</th><th>Full ocation address</th><th>Delete</th></tr>";
	for(var y=0;y<selectedLocationsAddressesArray.length;y++){
		tempStringWithTr+="<tr><td>"+y+"</td><td>"+selectedLocationsAddressesArray[y]+"</td><td style='text-align:center'><button type='button' class='btn btn-danger' style='width:50%' onClick='deletePointFromList("+y+");'>X</div></td></tr>";
		//document.getElementById("allAddedLocationsPanelTable").innerHTML+="<tr><td>"+y+"</td><td>"+selectedLocationsAddressesArray[y]+"</td><td style='text-align:center'><button type='button' class='btn btn-danger' style='width:50%' onClick='deletePointFromList("+y+");'>X</div></td></tr>";
		//alert(selectedLocationsAddressesArray[i]);
	}
	document.getElementById("allAddedLocationsPanelTable").innerHTML=tempStringWithTr;
	//resetMap();
	//initialize();
	var tempPointsLenght=points.length;
	latestLocation=new google.maps.LatLng(points[tempPointsLenght-1][0],points[tempPointsLenght-1][1]);
	mapOptions={zoom:14,center:latestLocation};
	map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
	for(var y=0;y<points.length;y++){
		//var tempLocation={points[y][0]+","+points[y][1]};
		var tempLocation=new google.maps.LatLng(points[y][0],points[y][1]);
		//alert(tempLocation);
		addMarker(tempLocation,map);
		//alert("added");
	}
}


function refreshPointsOnMap(){
	for(var i=0;i<points.length;i++){
		
	}
}

function showAllAddedLocationsList2(){
	for(var i=0;i<selectedLocationsAddressesArray.length;i++){
		document.getElementById("allAddedLocationsPanelTable").innerHTML+="<tr><td>"+i+"</td><td>"+selectedLocationsAddressesArray[i]+"</td><td style='text-align:center'><button type='button' class='btn btn-danger' style='width:50%' onClick='deletePointFromList("+i+");'>X</div></td></tr>";
		//alert(selectedLocationsAddressesArray[i]);
	}
	document.getElementById("allAddedLocationsPanel").style.display="inline";
}


function allAddedLocationsPanelCloseButtonAction(){
	//document.gallAddedLocationsButton
	document.getElementById("allAddedLocationsPanel").style.display="none";
}

function saveAsPDF(){
	var win = window.open('', '');
	win.document.write("<table border='1' style='width:100%;'>");
	win.document.write(document.getElementById("detailsTable").innerHTML);
	win.document.write("</table>");
	win.document.close();
	win.print();    // PRINT THE CONTENTS.
	win.close();
}

function shareViaEmail() {
  var tableContent = ""+document.getElementById("panelWithDetailsTable").innerHTML+"";
  alert(tableContent);
  //window.location.href = "mailto:"+email+"?subject="+subject+"&body="+mBody;
  //window.location.href = "mailto:<enter email>?subject=<enter subject>&body="+tableContent;
}


function detailsPanelCloseButtonAction(){
	document.getElementById("panelWithDetails").style.display="none";
}

function detailsPanelOpenButtonAction(){
	document.getElementById("panelWithDetails").style.display="inline";
}

geocoder = new google.maps.Geocoder();
marker = new google.maps.Marker({map,});


function clearMarkers() {
  marker.setMap(null);
  document.getElementById("foundLocationButtonContainer").style.display="none";
  document.getElementById("addressFoundContainer").style.display="none";
}

function geocode(request) {
	clearMarkers();
	tempFoundLocation=[];
	  document.getElementById("foundLocationButtonContainer").style.display="none";
	  document.getElementById("addressFoundContainer").style.display="none";
  geocoder
    .geocode(request)
    .then((result) => {
      const { results } = result;
	  console.log(result.results[0]);
	  //alert(result.results[0].formatted_address);
      map.setCenter(results[0].geometry.location);
	  map.setZoom(19);
	  
      marker.setPosition(results[0].geometry.location);
      marker.setMap(map);
      //responseDiv.style.display = "block";
      //response.innerText = JSON.stringify(result, null, 2);
	  document.getElementById("foundLocationButtonContainer").style.display="inline";
	  document.getElementById("addressFoundContainer").style.display="inline";
	  document.getElementById("addressFoundContainer").innerHTML=""+result.results[0].formatted_address;
	  tempFoundLocation.push(result.results[0].geometry.location.lat(),result.results[0].geometry.location.lng(),result.results[0].geometry.location);
      //return results;
	  //return tempFoundLocation[0];
	  //console.log(tempFoundLocation);
	  //alert(tempFoundLocation);
    })
    .catch((e) => {
      //alert("Geocode was not successful for the following reason: " + e);
    });
}

function geocodeButton(){
	var locationText=prompt("Enter your detailed address here\nlike: \"ul. Mickiewicza 49, Warsaw, Poland\"");
	console.log("Nowy wpis:");
	geocode({address: locationText});
}

function addFoundLocation(){
	clearMarkers();
	points.push([tempFoundLocation[0],tempFoundLocation[1]]);
	addMarker(tempFoundLocation[2],map);
	//var locat
	alert("Location has been added!");
}



var distancesArray=[];
var ends=[];
var points=[];
var directionsArray=[];


function resetMap(){
	distancesArray=[];
	ends=[];
	points=[];
	directionsArray=[];
	labelIndex = 0;
	document.getElementById("result_StartLocation").innerHTML="&#160;";
	document.getElementById("result_EndLocation").innerHTML="&#160;";
	document.getElementById("result_Distance").innerHTML="&#160;";
	document.getElementById("result_Duration").innerHTML="&#160;";
	document.getElementById("detailsTable").innerHTML="<tr><th rowspan='2'>Summary</th><th>Start location</th><th>End location</th><th>Distance</th><th>Duration</th></tr><tr><td id='detailedResult_StartLocation'>&#160;</td><td id='detailedResult_EndLocation'>&#160;</td><td id='detailedResult_Distance'>&#160;</td><td id='detailedResult_Duration'>&#160;</td></tr><tr><td colspan='5'>&#160;</td></tr><tr id='tableDetailsHeader'><th>Route part</th><th>Start location</th><th>End location</th><th>Distance</th><th>Duration</th></tr>";
	initialize();
}


var directionsDisplay;
    var directionsService = new google.maps.DirectionsService();
	var directionsService2 = new google.maps.DirectionsService();
    var map;
	//const labels = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

function permut(string) {
	  if (string.length < 2) return string; // This is our break condition

	  var permutations = []; // This array will hold our permutations
	  for (var i = 0; i < string.length; i++) {
		var char = string[i];

		// Cause we don't want any duplicates:
		if (string.indexOf(char) != i) // if char was used already
		  continue; // skip it this time

		var remainingString = string.slice(0, i) + string.slice(i + 1, string.length); //Note: you can concat Strings via '+' in JS

		for (var subPermutation of permut(remainingString))
		  permutations.push(char + subPermutation)
	  }
	  return permutations;
	}

    
	
	
	
	
	function addMarker(location, map) {
	  new google.maps.Marker({
		position: location,
		//label: labels[labelIndex++ % labels.length],
		label: (""+labelIndex),
		map: map,
	  });
	  labelIndex++;
	}

    function initialize() {
        directionsDisplay = new google.maps.DirectionsRenderer();
        //var chicago = new google.maps.LatLng(37.334818, -121.884886);
        //var mapOptions = {
        //    zoom: 7,
        //    center: chicago
        //};
        map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        directionsDisplay.setMap(map);
		//document.getElementById("myBtn").addEventListener("click", function(){document.getElementById("selectDriveMethodPanel").style.display="inline";});
        //google.maps.event.addDomListener(document.getElementById('routebtn'), 'click', calcRoute);
  
		map.addListener("click", (mapsMouseEvent) => {
			//let infoWindow = new google.maps.InfoWindow({
			//	position: mapsMouseEvent.latLng,
			//});
			var latt=mapsMouseEvent.latLng.lat();
			var lngg=mapsMouseEvent.latLng.lng();
			points.push([latt,lngg]);
			ends.push({
				location:new google.maps.LatLng(latt,lngg),
				stopover:true
			});
			//infoWindow.setContent(
			//	JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
			//);
			//infoWindow.open(map);
			
			addMarker(mapsMouseEvent.latLng,map);
		});
		
		getCurrentLocation(function (loc) {
			if (loc != null) {
				map.setCenter(loc);
				map.setZoom(14);
			}
		});
    }
	
	function getCurrentLocation(complete) {
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function (position) {
				var location = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
				complete(location);
			}, function () {
				complete(null);
			});
		}
		else {
			complete(null);
		}
	}	
	
    function calcRoute() {    
	directionsArray=[];
	distancesArray=[];
	document.getElementById("result_StartLocation").innerHTML="&#160;";
	document.getElementById("result_EndLocation").innerHTML="&#160;";
	document.getElementById("result_Distance").innerHTML="&#160;";
	document.getElementById("result_Duration").innerHTML="&#160;";
	document.getElementById("detailsTable").innerHTML="<tr><th rowspan='2'>Summary</th><th>Start location</th><th>End location</th><th>Distance</th><th>Duration</th></tr><tr><td id='detailedResult_StartLocation'>&#160;</td><td id='detailedResult_EndLocation'>&#160;</td><td id='detailedResult_Distance'>&#160;</td><td id='detailedResult_Duration'>&#160;</td></tr><tr><td colspan='5'>&#160;</td></tr><tr id='tableDetailsHeader'><th>Route part</th><th>Start location</th><th>End location</th><th>Distance</th><th>Duration</th></tr>";

		/*var combinationsAmmount=points.length;
		if(combinationsAmmount===0 || combinationsAmmount===1){
			//console.log(1);
			combinationsAmmount=0;
		}else{
			for (var i=combinationsAmmount-1; i>=1; i--) {
				combinationsAmmount *= i;
			}
		}*/
		//console.log(combinationsAmmount);
		//var combinationsAmmount=points.length
		//estimateTimeCounter(points.length,1000,"estimatedTime");
		//estimateTimeCounter(combinationsAmmount,1000,"estimatedTime");
	
		var start=new google.maps.LatLng(points[0][0],points[0][1]);
		var end=new google.maps.LatLng(points[points.length-1][0],points[points.length-1][1]); 
		var end2 = [];
		var wpoints=[];
		var tempString="";
		for(var i=1;i<points.length-1;i++){
			wpoints.push({
				location: new google.maps.LatLng(points[i][0],points[i][1]),
				stopover: true,
			});
			tempString+=""+i;
		}
		end2.push({
        location: new google.maps.LatLng(37.369176, -122.036969),
        stopover: true,
      });
	  
	  var allWaypointsCombinations=permut(tempString);
	  var waypointsArray=[];
	  
	  //for(var i=0; i<allWaypointsCombinations.length; i++){
		//allWaypointsCombinations[i]=""+0+allWaypointsCombinations[i]+""+(points.length-1);
	  //}
	  
	  console.log("TO");
	  console.log(allWaypointsCombinations);
	  
	  var combinationsAmmountForTime=allWaypointsCombinations.length;
	  for(var i=0; i<allWaypointsCombinations.length; i++){
		var tempDirections=[];
		for(var y=0; y<allWaypointsCombinations[i].length; y++){
			var tempLat=points[allWaypointsCombinations[i][y]][0];
			var tempLng=points[allWaypointsCombinations[i][y]][1];
			tempDirections.push({
				//location: tempLat+","+tempLng,
				location: new google.maps.LatLng(tempLat,tempLng),
				stopover: true,
			});
		}
		directionsArray.push(tempDirections);
	  }
	  
	  estimateTimeCounter(combinationsAmmountForTime,1000,"estimatedTime");
	  console.log("DirectionsArray:");
	  console.log(directionsArray);
	  
	  var directionsAndDistances=[];
	  
	  var valuesArray=[];//
	  
	  
	  document.getElementById("loadingPanel").style.display="inline";
	  for(var i=0; i<=directionsArray.length; i++){
		if(i<directionsArray.length){
			calculate(i,directionsArray.length);
		}else if(i==directionsArray.length){
			finishCalculation(i,directionsArray.length);
		}
	  }
    	
	  
	  function calculate(i,k){
		setTimeout(function(){
			var tempDistance=0;
			var tempRequest={
				origin: start,
				destination: end,
				waypoints: directionsArray[i],
				unitSystem: google.maps.UnitSystem.METRIC,
				travelMode: google.maps.TravelMode.DRIVING
			};
			
			directionsService.route(tempRequest, function(response, status){
				if(status==google.maps.DirectionsStatus.OK){
					//alert("yeah");
					for(var y=0; y<response.routes.length; y++){
						var currentDistance=0;
						for(var z=0; z<response.routes[y].legs.length; z++){
							//alert(response.routes[y].legs[z].distance.value);
							currentDistance+=response.routes[y].legs[z].distance.value;
						}//alert(i+": "+currentDistance);
						distancesArray.push(currentDistance);
					}
				}else{
					//alert("dupa");
				}
				var percent=""+(((i+1)*100)/k)+"%";
				var percentRounded=Math.round((((i+1)*100)/k));
				document.getElementById("progressValue").style.width=percent;
				document.getElementById("progress").setAttribute("data-label",percentRounded+"% Complete");
			});
		},1000*i);
	  }
	  
	  function finishCalculation(i,k){
		setTimeout(function(){
			//alert("Finished, your all distances are: "+distancesArray);
			var indexOfThrBestRoute=distancesArray.indexOf(Math.min.apply(null,distancesArray));
			//alert(indexOfThrBestRoute);
			
			
			//oczyszczanie tabel przed kolejnym liczeniem
			
			//koniec oczyszczania tabel przed kolejnym liczeniem
			
			var bounds = new google.maps.LatLngBounds();
			bounds.extend(start);
			bounds.extend(end);
			map.fitBounds(bounds);
			
			var request={
				origin: start,
				destination: end,
				waypoints: directionsArray[indexOfThrBestRoute],
				unitSystem: google.maps.UnitSystem.METRIC,
				travelMode: google.maps.TravelMode.DRIVING
			};
			
			directionsService.route(request,function(response,status){
				if(status==google.maps.DirectionsStatus.OK){
					directionsDisplay.setDirections(response);
					directionsDisplay.setMap(map);
					console.log("Final route is:");
					console.log(response);
					
					//realizacja przypisania do tabel
					var full_distance=0;
					var full_duration=0;
					var start_location="";
					var end_location="";
					for(var w=0; w<response.routes[0].legs.length; w++){
						full_distance+=response.routes[0].legs[w].distance.value;
						full_duration+=response.routes[0].legs[w].duration.value;
						if(w==0){
							start_location=""+response.routes[0].legs[w].start_address;
						}
						if(w==(response.routes[0].legs.length-1)){
							end_location=""+response.routes[0].legs[w].end_address;
						}
						
						//gromadzenie wszystkich sciezek
						var tempPartDistance=response.routes[0].legs[w].distance.value;
						var tempPartDuration=response.routes[0].legs[w].duration.value;
						var tempPartStartLoc=""+response.routes[0].legs[w].start_address;
						var tempPartEndLoc=""+response.routes[0].legs[w].end_address;
						
						if(tempPartDistance>=1000){
							tempPartDistance=tempPartDistance/1000;
							tempPartDistance=(Math.round(tempPartDistance * 100) / 100).toFixed(2);
							tempPartDistance=""+tempPartDistance+" km";
						}else{
							tempPartDistance=""+tempPartDistance+" m";
						}
						
						if(tempPartDuration>=3600){
							var tempPartHours=Math.floor(tempPartDuration/3600);
							var tempPartMins=Math.round(tempPartDuration-(tempPartHours*3600)*60);
							tempPartDuration=""+tempPartHours+" h "+tempPartMins+" min";
						}else{
							var tempPartMins=Math.round(tempPartDuration/60);
							tempPartDuration=""+tempPartMins+" min";
						}
						
						document.getElementById("detailsTable").innerHTML+="<tr><td>"+(w+1)+"</td><td>"+tempPartStartLoc+"</td><td>"+tempPartEndLoc+"</td><td>"+tempPartDistance+"</td><td>"+tempPartDuration+"</td></tr>";
						
						//koniec gromadzenia wszystkich sciezek
					}
					if(full_distance>=1000){
						full_distance=full_distance/1000;
						full_distance=(Math.round(full_distance * 100) / 100).toFixed(2);
						full_distance=""+full_distance+" km";
					}else{
						full_distance=""+full_distance+" m";
					}
					
					if(full_duration>=3600){
						var tempHours=Math.floor(full_duration/3600);
						var tempMins=Math.round(full_duration-(tempHours*3600)*60);
						full_duration=""+tempHours+" h "+tempMins+" min";
					}else{
						var tempMins=Math.round(full_duration/60);
						full_duration=""+tempMins+" min";
					}
					
					
					
					document.getElementById("result_StartLocation").innerHTML=start_location;
					document.getElementById("result_EndLocation").innerHTML=end_location;
					document.getElementById("result_Distance").innerHTML=full_distance;
					document.getElementById("result_Duration").innerHTML=full_duration;
					document.getElementById("detailedResult_StartLocation").innerHTML=start_location;
					document.getElementById("detailedResult_EndLocation").innerHTML=end_location;
					document.getElementById("detailedResult_Distance").innerHTML=full_distance;
					document.getElementById("detailedResult_Duration").innerHTML=full_duration;
					//koniec realizacji przypisania do tabel
				}else{
					//alert("no i no");
				}
			});
			var percent=""+(((i+1)*100)/k)+"%";
			var percentRounded=Math.round((((i+1)*100)/k));
			document.getElementById("progressValue").style.width=percent;
			document.getElementById("progress").setAttribute("data-label",percentRounded+"% Complete");
			document.getElementById("loadingPanel").style.display="none";
		},1000*i);
	  }
	  
	  
	  //setTimeout(function(){
		//alert(distancesArray);
		//}, 2000);
	  
	  //
	  /*
	  
        var bounds = new google.maps.LatLngBounds();
        bounds.extend(start);
        bounds.extend(end);
        map.fitBounds(bounds);
        var request = {
            origin: start,
            destination: end,
			waypoints: wpoints,
			unitSystem: google.maps.UnitSystem.METRIC,
            travelMode: google.maps.TravelMode.DRIVING
        };
        directionsService.route(request, function (response, status) {
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
                directionsDisplay.setMap(map);
				
				for(var i=0; i<response.routes.length; i++){
					for(var j=0; j<response.routes[i].legs.length; j++){
						console.log(response.routes[i].legs[j].distance.value)
					}
				}
				console.log(points);
				
            } else {
                alert("Directions Request from " + start.toUrlValue(6) + " to " + end.toUrlValue(6) + " failed: " + status);
            }
        });
		
	*/
	//
		
    }

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</body>
</html>
